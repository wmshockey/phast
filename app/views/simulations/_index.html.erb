<h2 class="col-sm-4", , data-toggle="tooltip" title="A simulation specification joins a specific pipeline together with the nomination shipments to be pumped through the line.  It also specifies the desired flowrate and batch sizing for the line.">Simulations <%= image_tag("simulation-icon.png") %></h2>
<h2 class="col-sm-8 text-right"><span data-toggle="tooltip" title="Show form to create a new simulation record"><%= link_to 'Add Simulation', new_simulation_path, class: 'btn btn-success' %></span></h2>

<table class="table table-bordered table-hover table-condensed">
  <thead>
   <tr>
	  <% if current_user.admin? then %>
		<th>User</th>
	  <% end %>
      <th>Name</th>
	  <th>Description</th>
      <th>Pipeline</th>
	  <th>Nomination</th>
	  <th>Max Flowrate (m3/hr)</th>
	  <th>Max Batchsize (m3)</th>
	  <th>Max Steptime (hrs)</th>
    </tr>
  </thead>

  <tbody>
	<% @simulations.order(name: :asc).each do |simulation| %>
      <tr>
		<% if current_user.admin? then %>
			<% pipeline = Pipeline.find {|p| p.id == simulation.pipeline_id} %>
			<% nomination  = Nomination.find {|n| n.id == simulation.nomination_id} %>
			<td><%= (User.find {|u| u.id == simulation.user_id}).email %></td>
		<% else %>
			<% pipeline = current_user.pipelines.find {|p| p.id == simulation.pipeline_id} %>
			<% nomination = current_user.nominations.find {|n| n.id == simulation.nomination_id} %>
		<% end %>
        <td><%= link_to simulation.name, simulation_path(simulation) %></td>
		<td><%= simulation.description %></td>
		<% if pipeline then %>
        	<td><%= link_to pipeline.name, pipeline %></td>
		<% else %>
			<td><%= "Pipeline missing" %></td>
		<% end %>
		<% if nomination then %>
        	<td><%= link_to nomination.name, nomination %></td>
		<% else %>
			<td><%= "Nomination missing " %></td>
		<% end %>
        <td><%= simulation.max_flowrate %></td>
        <td><%= simulation.max_batchsize %></td>
		<td><%= simulation.max_steptime %></td>
      </tr>
	<% end %>
  </tbody>
</table>

