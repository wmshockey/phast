<h2>Nominations</h2>
<table>
  <thead>
   <tr>
	  <% if current_user.admin? then %>
		<th>User</th>
	  <% end %>
      <th>Name</th>
	  <th>Description</th>
	  <th>Pipeline</th>
	  <th>Nomination Date</th>
	  <th>Period (days)</th>
    </tr>
  </thead>

  <% nominations_array = Array.new %>
  <% @nominations.each do |n| %>
    <% pipeline_id = n.pipeline_id %>
    <% user_id = Pipeline.find(pipeline_id).user_id %>
    <% nominations_array << [user_id, n] %>
  <% end %>
  <% nominations_array = nominations_array.sort_by {|x,y| [x, y.name] } %>

  <tbody>
	<% nominations_array.each do |e| %>
	  <% nomination = e[1] %>
	  <% if !nomination.errors.any? %>
	      <tr>
			<% if current_user.admin? then %>
				<% user_id = e[0] %>
				<% user_email = User.find(user_id).email %>
				<td><%= user_email %></td>
			<% end %>
	        <td><%= link_to nomination.name, nomination_path(nomination) %></td>
	        <td><%= nomination.description %></td>
			<td><%= @pipelines.find {|p| p.id == nomination.pipeline_id}.name %></td>
			<td><%= nomination.nom_date %></td>
			<td><%= nomination.period %></td>
	      </tr>
	  <% end %>
	<% end %>
	<td colspan="5"><%= link_to 'Add Nomination', new_nomination_path %></td>
  </tbody>
</table>
