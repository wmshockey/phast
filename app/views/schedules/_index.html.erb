<h2>Schedules</h2>
<table>
  <thead>
   <tr>
	  <% if current_user.admin? then %>
		<th>User</th>
	  <% end %>
      <th>Name</th>
	  <th>Description</th>
	  <th>Pipeline</th>
	  <th>Start Date</th>
	  <th>Period (days)</th>
	  <th>Type</th>
    </tr>
  </thead>

  <tbody>
	<% @schedules.order(name: :asc).each do |schedule| %>
	  <% if !schedule.errors.any? %>
	      <tr>
			<% if current_user.admin? then %>
				<% pipeline_id = schedule.pipeline_id %>
				<% user_id = Pipeline.find(pipeline_id).user_id %>
				<% user_email = User.find(user_id).email %>
				<td><%= user_email %></td>
			<% end %>
	        <td><%= link_to schedule.name, schedule_path(schedule) %></td>
	        <td><%= schedule.description %></td>
	        <td><%= @pipelines.find {|p| p.id == schedule.pipeline_id}.name %></td>
	        <td><%= schedule.start_date %></td>
	        <td><%= schedule.period %></td>
	        <td><%= schedule.sched_type %></td>
	      </tr>
	  <% end %>
	<% end %>
	<td colspan="6"><%= link_to 'Add Schedule', new_schedule_path %></td>
  </tbody>
</table>
